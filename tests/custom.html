<!DOCTYPE html>
<html lang="en-gb" dir="ltr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Custom - UIkit tests</title>
        <script src="js/test.js"></script>
        <style>
            .uk-view {
                transition: opacity 300ms ease;
            }
            .uk-view.uk-empty {
                opacity: 0;
            }
        </style>
        <script>
            function getNodeContent(node) {
                var header = node && node.querySelector('h3');
                return header ? header.textContent : '';
            };
        
            document.addEventListener('DOMContentLoaded', function() {
                var images = ['photo.jpg', 'photo2.jpg', 'photo3.jpg'];
                var count = 0;
                
                document.querySelectorAll('.uk-view').forEach(function(elem) {
                    var view = UIkit.view(elem);
                    var on = UIkit.util.on;
                    
                    on(view.$el, 'beforeitemshow', function(event, component) {
                        console.log('BEFORE SHOW', getNodeContent(event.target));
                        // event.preventDefault(); // Optional: reject
                    });
                
                    on(view.$el, 'beforeitemhide', function(event, component) {
                        console.log('BEFORE HIDE', getNodeContent(event.target));
                        // event.preventDefault(); // Optional: reject
                    });
                    
                    on(view.$el, 'itemhidden', function(event, component) {
                        console.log('HIDDEN', getNodeContent(event.target));
                    });
                    
                    on(view.$el, 'retain', function(event, component, id) {
                        console.log('RETAIN: %s', id, getNodeContent(event.target));
                        UIkit.util.remove(event.target);
                    });
                    
                    on(view.$el, 'transition', function(event, component, next, prev) {
                        console.log('1. BEGIN TRANSITION');
                    });
                    
                    on(view.$el, 'createtransition', function(event, component, next, prev, options) {
                        console.log('2. CREATE TRANSITION: %s', options.direction < 0 ? 'backward' : 'forward');
                    });
                    
                    on(view.$el, 'transitioned', function(event, component, next, prev) {
                        console.log('3. END TRANSITION');
                    });
                    
                    on(view.$el, 'switchview', function(event, component, viewName) {
                        console.log('SWITCH VIEW: %s', viewName);
                    });
                    
                    UIkit.util.on(view.$el, 'click', function(event) {
                        if (event.altKey) {
                            return view.promise.then(function() {
                                return view.show(null);
                            });
                        }
                        
                        view.promise.then(function() {
                            count = count + 1;
                            
                            var img = document.createElement('img');
                            img.setAttribute('uk-cover', '');
                            img.src = 'images/' + images[count % 3];
                            var item = document.createElement('div');
                            item.className = 'uk-background-' + (count % 2 ? 'secondary' : 'primary');
                            item.appendChild(img);
                            
                            var overlay = document.createElement('h3');
                            overlay.className = 'uk-position-center uk-margin-remove uk-text-uppercase';
                            overlay.textContent = 'Item ' + count;
                            item.appendChild(overlay);
                            
                            // Optional: retain the element (see retain event above)
                            item.setAttribute('data-retain', 'foo');
                            
                            return new Promise(function(resolve, reject) {
                                img.onload = resolve;
                                img.onerror = reject;
                            }).then(function() {
                                return view.show(item, count % 2 ? -1 : 1);
                            });
                        }).then(function(elem) {
                            console.log('COMPLETED', getNodeContent(elem));
                        }, function() {
                            console.log('REJECTED');
                        });
                    });
                });
            });
        </script>
    </head>
    <body>
        <div class="uk-container uk-margin-large-bottom">
            <div class="uk-child-width-1-2 uk-grid-small" uk-grid>
                <div>
                    <div class="uk-background-muted uk-light" uk-view="animation: none" uk-ratio="ratio: 3:1">
                        <div class="uk-flex uk-flex-center uk-flex-middle uk-background-primary">
                            <h3 class="uk-text-uppercase">None</h3>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="uk-background-muted uk-light" uk-view="duration: 300" uk-ratio="ratio: 3:1">
                        <div class="uk-flex uk-flex-center uk-flex-middle uk-background-primary">
                            <h3 class="uk-text-uppercase">Fade</h3>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="uk-background-muted uk-light" uk-view="animation: slide" uk-ratio="ratio: 2:1">
                        <div class="uk-flex uk-flex-center uk-flex-middle uk-background-primary">
                            <h3 class="uk-text-uppercase">Slide</h3>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="uk-background-muted uk-light" uk-view="animation: scale" uk-ratio="ratio: 2:1">
                        <div class="uk-flex uk-flex-center uk-flex-middle uk-background-primary">
                            <h3 class="uk-text-uppercase">Scale</h3>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="uk-background-muted uk-light" uk-view="animation: push" uk-ratio>
                        <div class="uk-flex uk-flex-center uk-flex-middle uk-background-primary">
                            <h3 class="uk-text-uppercase">Push</h3>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="uk-background-muted uk-light" uk-view="animation: pull" uk-ratio>
                        <div class="uk-flex uk-flex-center uk-flex-middle uk-background-primary">
                            <h3 class="uk-text-uppercase">Pull</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
